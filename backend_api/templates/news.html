{% extends "layout.html" %}
{% block title %}Tin t·ª©c - D·ª± b√°o Th·ªùi ti·∫øt AI{% endblock %}

{% block content %}
<div class="fixed inset-0 -z-10 h-full w-full bg-gradient-to-br from-blue-50 via-blue-100 to-purple-100 dark:from-gray-900 dark:via-blue-900 dark:to-purple-900 overflow-hidden">
    <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 rounded-full bg-blue-400/20 blur-3xl animate-blob"></div>
    <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-80 h-80 rounded-full bg-purple-400/20 blur-3xl animate-blob animation-delay-2000"></div>
    <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 rounded-full bg-pink-400/20 blur-3xl animate-blob animation-delay-4000"></div>
</div>

<div class="min-h-screen container mx-auto px-4 py-8">
    
    <div class="text-center mb-12 animate-fade-in-up">
        <span class="inline-block px-4 py-1.5 rounded-full bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 text-sm font-semibold tracking-wide shadow-sm border border-blue-200 dark:border-blue-800 mb-4">
            üì∞ C·∫≠p nh·∫≠t 24/7
        </span>
        <h1 class="text-4xl lg:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 leading-tight drop-shadow-sm">
            Tin T·ª©c & C·∫£nh B√°o <br> Thi√™n Tai
        </h1>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-8 animate-fade-in-up" style="animation-delay: 0.2s;">
            
            <div id="featured-news" class="relative group cursor-pointer">
                <div class="bg-white/40 dark:bg-gray-800/40 backdrop-blur-xl border border-white/60 dark:border-gray-600/60 rounded-[2rem] p-8 shadow-2xl h-96 flex items-center justify-center">
                    <div class="animate-spin rounded-full h-10 w-10 border-4 border-blue-500 border-t-transparent"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="news-grid">
                </div>
            
        </div>
        
        <div class="lg:col-span-1 space-y-8 animate-fade-in-up" style="animation-delay: 0.4s;">
            
            <div id="calendar-block" class="bg-white/60 dark:bg-gray-800/60 backdrop-blur-md rounded-[2rem] shadow-lg border border-white/50 dark:border-gray-700 p-6 relative overflow-hidden group hover:shadow-xl transition-all duration-300">
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-green-400/20 rounded-full blur-2xl"></div>

                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2">
                            <i data-lucide="calendar" class="w-5 h-5 text-green-600"></i> L·ªãch V·∫°n S·ª±
                        </h3>
                        <span class="text-xs font-semibold px-2 py-1 bg-green-100 text-green-700 rounded-lg">H√¥m nay</span>
                    </div>

                    <div class="text-center mb-6">
                        <div class="flex justify-center items-center gap-6">
                            <button id="prev_date" class="p-2 hover:bg-black/5 rounded-full transition-colors text-gray-400 hover:text-green-600">
                                <i data-lucide="chevron-left" class="w-6 h-6"></i>
                            </button>
                            <div class="flex flex-col items-center">
                                <span id="calendar-day" class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-br from-green-600 to-teal-500">--</span>
                                <span id="calendar-weekday" class="text-lg font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider">--</span>
                            </div>
                            <button id="next_date" class="p-2 hover:bg-black/5 rounded-full transition-colors text-gray-400 hover:text-green-600">
                                <i data-lucide="chevron-right" class="w-6 h-6"></i>
                            </button>
                        </div>
                        <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">
                            Th√°ng <span id="calendar-month-year">--</span>
                        </div>
                    </div>

                    <div class="bg-white/50 dark:bg-gray-700/50 rounded-2xl p-4 border border-white/40">
                        <div class="flex justify-between items-center border-b border-gray-200 dark:border-gray-600 pb-3 mb-3">
                            <div class="text-left">
                                <div class="text-xs text-gray-500 uppercase">√Çm L·ªãch</div>
                                <div class="text-2xl font-bold text-gray-800 dark:text-white" id="calendar-lunar-day">--</div>
                                <div class="text-xs text-gray-600 dark:text-gray-300" id="calendar-lunar-month">--</div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500 uppercase">Gi·ªù Ho√†ng ƒê·∫°o</div>
                                <div class="text-sm font-medium text-green-700 dark:text-green-400 mt-1">
                                    D·∫ßn, M√£o, T·ªµ,<br>Th√¢n, Tu·∫•t, H·ª£i
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-xs text-gray-600 dark:text-gray-300">
                            <span id="calendar-lunar-year">--</span>
                            <span id="calendar-time" class="font-mono font-bold text-blue-600 dark:text-blue-400">--:--:--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white/60 dark:bg-gray-800/60 backdrop-blur-md rounded-[2rem] shadow-lg border border-white/50 dark:border-gray-700 p-6">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center gap-2">
                    <i data-lucide="zap" class="w-5 h-5 text-yellow-500"></i> C·∫£nh b√°o nhanh
                </h3>
                <ul class="space-y-3" id="quick-links">
                    </ul>
            </div>

        </div>
        
    </div>
</div>

<style>
    @keyframes fade-in-up {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up { animation: fade-in-up 0.8s ease-out forwards; opacity: 0; }
    
    @keyframes blob {
        0% { transform: translate(0px, 0px) scale(1); }
        33% { transform: translate(30px, -50px) scale(1.1); }
        66% { transform: translate(-20px, 20px) scale(0.9); }
        100% { transform: translate(0px, 0px) scale(1); }
    }
    .animate-blob { animation: blob 7s infinite; }
    .animation-delay-2000 { animation-delay: 2s; }
    .animation-delay-4000 { animation-delay: 4s; }
</style>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/lucide@latest"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        initNewsPage();
        initCalendar();
    });

    // --- MOCK DATA GENERATOR ---
    const PROVINCES_SAMPLE = ['H√† N·ªôi', 'TP. H·ªì Ch√≠ Minh', 'ƒê√† N·∫µng', 'H·∫£i Ph√≤ng', 'C·∫ßn Th∆°', 'L√†o Cai', 'Ngh·ªá An', 'Qu·∫£ng Ninh'];
    
    // Kho ·∫£nh ch·∫•t l∆∞·ª£ng cao (Unsplash Direct Links - ƒê·∫£m b·∫£o ho·∫°t ƒë·ªông)
    const IMAGES = {
    // B√£o, √°p th·∫•p, m∆∞a l·ªõn, c·∫£nh b√°o thi√™n tai
        warning: "https://images.pexels.com/photos/1784577/pexels-photo-1784577.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",

        // N·∫Øng n√≥ng gay g·∫Øt, tr·ªùi oi b·ª©c
        hot: "https://images.pexels.com/photos/709552/pexels-photo-709552.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",

        // R√©t ƒë·∫≠m, s∆∞∆°ng m√π, kh√¥ng kh√≠ l·∫°nh, v√πng n√∫i
        cold: "https://images.pexels.com/photos/1363876/pexels-photo-1363876.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",

        // UV cao, tr·ªùi xanh, bi·ªÉn ƒë·∫πp, n·∫Øng v√†ng
        uv: "https://images.pexels.com/photos/358457/pexels-photo-358457.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",

        // Ng·∫≠p l·ª•t, m∆∞a l·ªõn k√©o d√†i, tri·ªÅu c∆∞·ªùng
        flood: "https://images.pexels.com/photos/2387873/pexels-photo-2387873.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2",

        // ·∫¢nh n·ªïi b·∫≠t (featured) ‚Äì ƒë·∫πp, h√πng vƒ©, ph√π h·ª£p l√†m ti√™u ƒë·ªÅ
        featured: "https://images.pexels.com/photos/844297/pexels-photo-844297.jpeg?auto=compress&cs=tinysrgb&w=1600"
    };

    function getRandomItem(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

    function generateNews() {
        const news = [];
        const today = new Date();
        
        // 1. Featured News (Tin quan tr·ªçng nh·∫•t h√¥m nay) - Th·ªùi ti·∫øt v√† thi√™n tai nƒÉm 2025
        const p1 = 'To√†n qu·ªëc';
        news.push({
            id: 1,
            title: `Th·ªùi ti·∫øt v√† thi√™n tai nƒÉm 2025 s·∫Ω di·ªÖn bi·∫øn th·∫ø n√†o?`,
            summary: `ƒê√°ng ch√∫ √Ω, trong kho·∫£ng th·ªùi gian d·ª± b√°o t·ª´ th√°ng 3-5/2025, tr√™n ph·∫°m vi c·∫£ n∆∞·ªõc c√≥ kh·∫£ nƒÉng x·∫£y ra c√°c hi·ªán t∆∞·ª£ng th·ªùi ti·∫øt nguy hi·ªÉm nh∆∞ d√¥ng, l·ªëc, s√©t, m∆∞a ƒë√° v√† gi√≥ gi·∫≠t m·∫°nh nguy hi·ªÉm.`,
            image: IMAGES.warning, // ·∫¢nh Featured cho c·∫£nh b√°o thi√™n tai
            date: today.toLocaleDateString('vi-VN'),
            link: `https://moitruong.net.vn/thoi-tiet-va-thien-tai-nam-2025-se-dien-bien-the-nao-80955.html`,
            featured: true,
            province: p1,
            source: 'M√¥i Tr∆∞·ªùng'
        });

        // 2. Sub News (Tin ph·ª•) - D·ª±a tr√™n c√°c tin th·ªùi ti·∫øt th·ª±c t·∫ø
        const subNews = [
            {
                title: `D·ª± b√°o m√πa h√® 2025 n·∫Øng n√≥ng √≠t gay g·∫Øt h∆°n`,
                summary: `C∆° quan kh√≠ t∆∞·ª£ng th·ªßy vƒÉn nh·∫≠n ƒë·ªãnh, tr√™n ph·∫°m vi c·∫£ n∆∞·ªõc c√≥ kh·∫£ nƒÉng x·∫£y ra c√°c hi·ªán t∆∞·ª£ng th·ªùi ti·∫øt nguy hi·ªÉm nh∆∞ d√¥ng, l·ªëc, s√©t, m∆∞a ƒë√° v√† gi√≥ gi·∫≠t m·∫°nh. M∆∞a s·∫Ω tƒÉng d·∫ßn trong c√°c th√°ng t·ªõi.`,
                image: IMAGES.hot,
                date: today.toLocaleDateString('vi-VN'),
                link: `https://baochinhphu.vn/du-bao-mua-he-2025-nang-nong-it-gay-gat-hon-102250318161759202.htm`,
                featured: false,
                province: 'To√†n qu·ªëc',
                source: 'B√°o Ch√≠nh Ph·ªß'
            },
            {
                title: `D·ª± b√°o n·∫Øng n√≥ng gay g·∫Øt trong nƒÉm 2025`,
                summary: `Nh·∫≠n ƒë·ªãnh v·ªÅ xu th·∫ø c√°c h√¨nh th√°i th·ªùi ti·∫øt c√≥ kh·∫£ nƒÉng x·∫£y ra trong nƒÉm 2025, nhi·ªát ƒë·ªô to√†n c·∫ßu c√≥ xu h∆∞·ªõng tƒÉng, do v·∫≠y Vi·ªát Nam kh·∫£ nƒÉng s·∫Ω ph·∫£i ƒë·ªëi m·∫∑t v·ªõi n·∫Øng n√≥ng, n·∫Øng n√≥ng gay g·∫Øt v√† kh·ªëc li·ªát.`,
                image: IMAGES.hot,
                date: today.toLocaleDateString('vi-VN'),
                link: `https://baochinhphu.vn/du-bao-nang-nong-gay-gat-trong-nam-2025-102241218165504533.htm`,
                featured: false,
                province: 'Vi·ªát Nam',
                source: 'B√°o Ch√≠nh Ph·ªß'
            },
            {
                title: `NƒÉm 2025, xu th·∫ø th·ªùi ti·∫øt c√≥ g√¨ b·∫•t th∆∞·ªùng?`,
                summary: `Xu th·∫ø th·ªùi ti·∫øt nƒÉm 2025 d·ª± b√°o c√≥ kho·∫£ng 5-6 c∆°n b√£o/√°p th·∫•p nhi·ªát ƒë·ªõi ·∫£nh h∆∞·ªüng ƒë·∫øn ƒë·∫•t li·ªÅn n∆∞·ªõc ta; x√¢m nh·∫≠p m·∫∑n tƒÉng cao ·ªü ƒêBSCL.`,
                image: IMAGES.warning,
                date: today.toLocaleDateString('vi-VN'),
                link: `https://nld.com.vn/nam-2025-xu-the-thoi-tiet-co-gi-bat-thuong-196250118134907213.htm`,
                featured: false,
                province: 'To√†n qu·ªëc',
                source: 'Ng∆∞·ªùi Lao ƒê·ªông'
            },
            {
                title: `Di·ªÖn bi·∫øn nh·ªØng h√¨nh th√°i th·ªùi ti·∫øt ƒë√°ng l∆∞u √Ω tr√™n c·∫£ n∆∞·ªõc nƒÉm 2025`,
                summary: `La Nina ƒëang ho·∫°t ƒë·ªông v√† kh·∫£ nƒÉng k√©o d√†i trong 3 th√°ng t·ªõi. C√°c hi·ªán t∆∞·ª£ng th·ªùi ti·∫øt kh√¥ng kh√≠ l·∫°nh, n·∫Øng n√≥ng, m∆∞a b√£o,‚Ä¶ trong nƒÉm 2025 d·ª± b√°o nhi·ªÅu di·ªÖn bi·∫øn kh√≥ l∆∞·ªùng.`,
                image: IMAGES.flood,
                date: today.toLocaleDateString('vi-VN'),
                link: `https://vietnamnet.vn/dien-bien-nhung-hinh-thai-thoi-tiet-dang-luu-y-tren-ca-nuoc-nam-2025-2363885.html`,
                featured: false,
                province: 'Vi·ªát Nam',
                source: 'VietnamNet'
            }
        ];
        
        news.push(...subNews);
        return news;
    }

    // --- RENDER LOGIC ---
    function initNewsPage() {
        const newsList = generateNews();
        
        const featuredContainer = document.getElementById('featured-news');
        const gridContainer = document.getElementById('news-grid');
        const quickLinksContainer = document.getElementById('quick-links');

        // Render Featured
        const feat = newsList[0];
        featuredContainer.innerHTML = `
            <div onclick="window.open('${feat.link}', '_blank')" class="relative overflow-hidden rounded-[2rem] h-96 shadow-2xl group transition-transform duration-300 hover:scale-[1.01]">
                <img src="${feat.image}" alt="${feat.title}" class="absolute inset-0 w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-transparent p-8 flex flex-col justify-end">
                    <span class="inline-block px-3 py-1 bg-red-600 text-white text-xs font-bold rounded-lg mb-3 w-fit animate-pulse">
                        TIN N·ªîI B·∫¨T
                    </span>
                    <h2 class="text-2xl lg:text-3xl font-bold text-white mb-2 leading-tight group-hover:text-blue-200 transition-colors">
                        ${feat.title}
                    </h2>
                    <p class="text-gray-200 line-clamp-2 mb-4 text-sm md:text-base hidden md:block">
                        ${feat.summary}
                    </p>
                    <div class="flex items-center text-gray-300 text-xs gap-4 mt-auto">
                        <span class="flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> ${feat.date}</span>
                        <span class="flex items-center gap-1"><i data-lucide="map-pin" class="w-3 h-3"></i> ${feat.province}</span>
                        <span class="ml-auto text-blue-300 font-semibold group-hover:translate-x-1 transition-transform flex items-center gap-1">
                            Xem chi ti·∫øt <i data-lucide="external-link" class="w-3 h-3"></i>
                        </span>
                    </div>
                </div>
            </div>
        `;

        // Render Grid
        gridContainer.innerHTML = newsList.slice(1).map(item => `
            <div onclick="window.open('${item.link}', '_blank')" class="bg-white/60 dark:bg-gray-800/60 backdrop-blur-md border border-white/50 dark:border-gray-700 rounded-3xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 hover:-translate-y-1 cursor-pointer group flex flex-col h-full">
                <div class="h-40 overflow-hidden relative">
                    <img src="${item.image}" alt="${item.title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    <div class="absolute top-3 right-3 bg-white/90 dark:bg-black/70 backdrop-blur text-xs font-bold px-2 py-1 rounded-lg shadow-sm">
                        ${item.date}
                    </div>
                </div>
                <div class="p-5 flex flex-col flex-1">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-2 line-clamp-2 group-hover:text-blue-600 transition-colors">
                        ${item.title}
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300 line-clamp-2 mb-4 flex-1">
                        ${item.summary}
                    </p>
                    <div class="flex items-center justify-between mt-auto pt-3 border-t border-gray-200 dark:border-gray-700">
                        <span class="text-xs text-gray-500 font-medium flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-3 h-3"></i> ${item.province}
                        </span>
                        <span class="text-xs text-blue-500">${item.source}</span>
                        <i data-lucide="external-link" class="w-4 h-4 text-gray-400 group-hover:text-blue-500"></i>
                    </div>
                </div>
            </div>
        `).join('');

        // Render Quick Links
        quickLinksContainer.innerHTML = PROVINCES_SAMPLE.slice(0, 5).map(p => `
            <li>
                <a href="/forecast?province=${encodeURIComponent(p)}" class="flex items-center justify-between p-3 rounded-xl hover:bg-white/50 dark:hover:bg-gray-700/50 transition-colors group border border-transparent hover:border-blue-200">
                    <span class="text-sm font-medium text-gray-700 dark:text-gray-200 group-hover:text-blue-600">${p}</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400 group-hover:text-blue-500"></i>
                </a>
            </li>
        `).join('');

        lucide.createIcons();
    }

    // --- CALENDAR LOGIC ---
    let currentDate = new Date();

    function initCalendar() {
        updateCalendar(currentDate);
        setInterval(() => {
            const now = new Date();
            document.getElementById('calendar-time').textContent = now.toLocaleTimeString('en-US', { hour12: false });
        }, 1000);

        document.getElementById('prev_date').onclick = () => {
            currentDate.setDate(currentDate.getDate() - 1);
            updateCalendar(currentDate);
        };
        document.getElementById('next_date').onclick = () => {
            currentDate.setDate(currentDate.getDate() + 1);
            updateCalendar(currentDate);
        };
    }

    function updateCalendar(date) {
        document.getElementById('calendar-day').textContent = date.getDate();
        document.getElementById('calendar-month-year').textContent = `${date.getMonth() + 1}/${date.getFullYear()}`;
        
        const options = { weekday: 'long' };
        let weekday = date.toLocaleDateString('vi-VN', options);
        weekday = weekday.charAt(0).toUpperCase() + weekday.slice(1);
        document.getElementById('calendar-weekday').textContent = weekday;

        // Gi·∫£ l·∫≠p √Çm l·ªãch (Demo)
        const fakeLunarDay = (date.getDate() + 10) % 30 || 30; // Logic gi·∫£ ƒë∆°n gi·∫£n
        document.getElementById('calendar-lunar-day').textContent = fakeLunarDay;
        document.getElementById('calendar-lunar-month').textContent = 'Th√°ng 9';
        document.getElementById('calendar-lunar-year').textContent = 'NƒÉm ·∫§t T·ªµ';
    }
</script>
{% endblock %}